(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{209:function(e,t,n){e.exports=n(482)},476:function(e,t,n){},482:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"NodeModel",function(){return bt}),n.d(a,"NodeFactory",function(){return fn}),n.d(a,"PortModel",function(){return vt});var i={};n.r(i),n.d(i,"NodeModel",function(){return bn}),n.d(i,"NodeFactory",function(){return Pn}),n.d(i,"PortModel",function(){return vn});var o={};n.r(o),n.d(o,"NodeModel",function(){return Mn}),n.d(o,"NodeFactory",function(){return Bn}),n.d(o,"PortModel",function(){return Tn});var r={};n.r(r),n.d(r,"NodeModel",function(){return Wn}),n.d(r,"NodeFactory",function(){return Rn}),n.d(r,"PortModel",function(){return Ln});var s={};n.r(s),n.d(s,"NodeModel",function(){return Hn}),n.d(s,"NodeFactory",function(){return Jn}),n.d(s,"PortModel",function(){return Vn});var l={};n.r(l),n.d(l,"NodeModel",function(){return Yn}),n.d(l,"NodeFactory",function(){return ta}),n.d(l,"PortModel",function(){return Xn});var c=n(0),d=n.n(c),m=n(27),u=n(26),p=n(47),h=n(184),g=n(28),f=n.n(g),v=n(22),b="segments_changed",E="triggers_changed",y="mails_changed",O="goals_changed",N="banners_changed",j="canvas_zoomable",k="canvas_pannable",w="canvas_zoomable_pannable",S="canvas_notification",P="set_scenario_id",T="set_scenario_name",M="set_scenario_payload",C="set_scenario_loading",x={avalaibleSegments:[]},F={avalaibleTriggers:[]},_={pannable:!0,zoomable:!0,notification:{open:!1,variant:"success",text:""}},D={id:null,name:"",loading:0,payload:null},U={availableMails:[]},I={availableGoals:[]},z={availableBanners:[]},B=Object(p.c)({segments:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:return Object(v.a)({},e,{avalaibleSegments:t.payload});default:return e}},triggers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E:return Object(v.a)({},e,{avalaibleTriggers:t.payload});default:return e}},canvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case k:return Object(v.a)({},e,{pannable:t.payload});case j:return Object(v.a)({},e,{zoomable:t.payload});case w:return Object(v.a)({},e,{zoomable:t.payload,pannable:t.payload});case S:return Object(v.a)({},e,{notification:Object(v.a)({},e.notification,t.payload)});default:return e}},scenario:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return Object(v.a)({},e,{id:t.payload});case T:return Object(v.a)({},e,{name:t.payload});case C:var n=e.loading;return t.payload?++n:--n,Object(v.a)({},e,{loading:n});case M:return Object(v.a)({},e,{payload:t.payload});default:return e}},mails:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return Object(v.a)({},e,{availableMails:t.payload});default:return e}},goals:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(v.a)({},e,{availableGoals:t.payload});default:return e}},banners:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N:return Object(v.a)({},e,{availableBanners:t.payload});default:return e}}}),L=n(4),W=n(7),A=n(5),G=n(2),R=n(6),V=function(){function e(){Object(L.a)(this,e)}return Object(W.a)(e,null,[{key:"load",value:function(){var e=document.createElement("script");e.type="text/javascript",e.src="/segmenter/vue.min.js";var t=document.createElement("script");t.type="text/javascript",t.src="/segmenter/RempSegmenter.umd.min.js";var n=document.createElement("link");n.rel="stylesheet",n.href="/segmenter/RempSegmenter.css",document.head.appendChild(e),document.head.appendChild(t),document.head.appendChild(n)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#segmenter";new window.Vue({render:function(e){return e(window.RempSegmenter)}}).$mount(e)}}]),e}(),H=n(185),K=n.n(H),q=n(13),J=n(24),X=n.n(J),Y=n(204),Z=n.n(Y),$=n(202),Q=n.n($),ee=n(201),te=n.n(ee),ne=n(203),ae=n.n(ne),ie=n(68),oe=n.n(ie),re=n(93),se=n.n(re),le=n(41),ce=n.n(le),de=n(10),me=n.n(de),ue=n(61),pe=n(83),he=n.n(pe),ge=n(84),fe=n.n(ge),ve=n(85),be=n.n(ve),Ee=n(88),ye=n.n(Ee),Oe=n(89),Ne=n.n(Oe),je=n(86),ke=n.n(je),we=n(90),Se=n.n(we),Pe=window.Scenario.config,Te=Pe.AUTH_TOKEN,Me=Pe.API_HOST,Ce=Pe.SCENARIO_ID,xe=Pe.BANNER_ENABLED,Fe="".concat(Me,"/scenarios/info?id="),_e="".concat(Me,"/scenarios/create"),De="".concat(Me,"/user-segments/list"),Ue="".concat(Me,"/events/list"),Ie="".concat(Me,"/mail-template/list"),ze="".concat(Me,"/onboarding-goals/list"),Be="".concat(Me,"/remp/list-banners"),Le="".concat(Me,"/scenarios/element"),We=n(122),Ae=n.n(We),Ge=n(186),Re=n.n(Ge),Ve=n(187),He=n.n(Ve),Ke=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,e))).state={},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"render",value:function(){var e=this;return c.createElement(Ae.a,{key:this.props.name,draggable:!0,onDragStart:function(t){t.dataTransfer.setData("storm-diagram-node",JSON.stringify(e.props.model))},className:"tray-item"},c.createElement(Re.a,null,this.props.icon),c.createElement(He.a,{primary:this.props.name}))}}]),t}(c.Component),qe=n(53);function Je(e,t){switch(t){case"minutes":return e;case"hours":return 60*e;case"days":return 60*e*24;default:return e}}var Xe=function(){function e(t){Object(L.a)(this,e),this.formatDescendant=function(e,t){var n={uuid:e.id};return"segment"===t.type?n.direction="right"===e.portName?"positive":"negative":"goal"===t.type&&(n.direction="right"===e.portName?"positive":"negative"),n},this.model=t}return Object(W.a)(e,[{key:"exportPayload",value:function(){var e=this,t={},n=this.model.serializeDiagram();return t.triggers={},t.elements={},t.visual={},n.nodes.filter(function(e){return"trigger"===e.type}).map(function(n){return t.triggers[n.id]=e.formatNode(n)}),Object.entries(this.model.getNodes()).forEach(function(e){t.visual[e[0]]={x:e[1].x,y:e[1].y}}),Object.entries(this.model.getNodes()).forEach(function(n){"trigger"!==n[1].type&&(t.elements[n[0]]=e.formatNode(n[1].serialize()))}),t}},{key:"getAllChildrenNodes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";return e.ports.find(function(e){return e.name===n}).links.map(function(a){var i=null;return i=t.model.links[a].targetPort.parent.id!==e.id?t.model.links[a].targetPort.parent:t.model.links[a].sourcePort.parent,Object(v.a)({},i.serialize(),{portName:n})})}},{key:"formatNode",value:function(e){var t=this;if("email"===e.type)return{id:e.id,name:e.name?e.name:"",type:"email",email:{code:e.selectedMail,descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}};if("banner"===e.type)return console.log("sending banner"),console.log(e.expiresInTime,e.expiresInUnit),{id:e.id,name:e.name?e.name:"",type:"banner",banner:{id:e.selectedBanner,expiresInMinutes:Je(e.expiresInTime,e.expiresInUnit),descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}};if("segment"===e.type){var n=this.getAllChildrenNodes(e,"right").map(function(n){return t.formatDescendant(n,e)}),a=this.getAllChildrenNodes(e,"bottom").map(function(n){return t.formatDescendant(n,e)});return{id:e.id,name:e.name?e.name:"",type:"segment",segment:{code:e.selectedSegment?e.selectedSegment:"all_users",descendants:[].concat(Object(qe.a)(n),Object(qe.a)(a))}}}if("trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"event",event:{code:e.selectedTrigger?e.selectedTrigger:"user_created"},elements:this.getAllChildrenNodes(e).map(function(e){return e.id})};if("wait"===e.type)return{id:e.id,name:e.name?e.name:"",type:"wait",wait:{minutes:Je(e.waitingTime,e.waitingUnit),descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}};if("goal"===e.type){var i=this.getAllChildrenNodes(e,"right").map(function(n){return t.formatDescendant(n,e)}),o=this.getAllChildrenNodes(e,"bottom").map(function(n){return t.formatDescendant(n,e)}),r={codes:e.selectedGoals?e.selectedGoals:[],descendants:[].concat(Object(qe.a)(i),Object(qe.a)(o)),recheckPeriodMinutes:Je(e.recheckPeriodTime,e.recheckPeriodUnit)};return e.timeoutTime&&e.timeoutUnit&&(r.timeoutMinutes=Je(e.timeoutTime,e.timeoutUnit)),{id:e.id,name:e.name?e.name:"",type:"goal",goal:r}}}}]),e}(),Ye=n(192),Ze=n.n(Ye),$e=n(123),Qe=n.n($e),et=n(188),tt=n.n(et),nt=n(190),at=n.n(nt),it=n(191),ot=n.n(it),rt=n(189),st=n.n(rt),lt={success:tt.a,warning:st.a,error:at.a,info:ot.a},ct=function(e){function t(){return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).apply(this,arguments))}return Object(R.a)(t,e),Object(W.a)(t,[{key:"render",value:function(){var e=lt[this.props.variant];return d.a.createElement(Ze.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:this.props.open,autoHideDuration:3e3,onClose:this.props.handleClose},d.a.createElement(Qe.a,{className:"toast-"+this.props.variant,message:d.a.createElement("span",{id:"client-snackbar",className:"toast__message"},d.a.createElement(e,{className:"toast__icon toast__icon-variant"}),this.props.text)}))}}]),t}(d.a.Component),dt=function(e){function t(e,n){var a;return Object(L.a)(this,t),(a=Object(A.a)(this,Object(G.a)(t).call(this,e))).cb=n,a}return Object(R.a)(t,e),Object(W.a)(t,[{key:"getNewInstance",value:function(e){return this.cb(e)}}]),t}(q.AbstractPortFactory),mt=n(23),ut=n(30),pt=function(e){function t(){var e;return Object(L.a)(this,t),(e=Object(A.a)(this,Object(G.a)(t).call(this,"custom"))).width=3,e.curvyness=50,e.color="rgba(0,0,0,0.3)",e}return Object(R.a)(t,e),t}(q.DefaultLinkModel),ht=function(e){function t(){var e;return Object(L.a)(this,t),(e=Object(A.a)(this,Object(G.a)(t).call(this))).type="custom",e}return Object(R.a)(t,e),Object(W.a)(t,[{key:"getNewInstance",value:function(e){return new pt}},{key:"generateLinkSegment",value:function(e,t,n,a){return c.createElement("path",{className:n?t.bem("--path-selected"):"",strokeWidth:e.width,stroke:e.color,d:a})}}]),t}(q.DefaultLinkFactory),gt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",a=arguments.length>1?arguments[1]:void 0;return Object(L.a)(this,t),(e=Object(A.a)(this,Object(G.a)(t).call(this,n,a))).position=n,e.in="left"===e.position,e}return Object(R.a)(t,e),Object(W.a)(t,[{key:"link",value:function(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}},{key:"canLinkToPort",value:function(e){return this.in!==e.in}},{key:"serialize",value:function(){return ut.merge(Object(mt.a)(Object(G.a)(t.prototype),"serialize",this).call(this),{position:this.position})}},{key:"deSerialize",value:function(e,n){Object(mt.a)(Object(G.a)(t.prototype),"deSerialize",this).call(this,e,n),this.position=e.position}},{key:"createLinkModel",value:function(){return new pt}}]),t}(q.PortModel),ft=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",a=arguments.length>1?arguments[1]:void 0;return Object(L.a)(this,t),(e=Object(A.a)(this,Object(G.a)(t).call(this,n,a))).position=n,e.in="left"===e.position,e}return Object(R.a)(t,e),Object(W.a)(t,[{key:"link",value:function(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}},{key:"serialize",value:function(){return ut.merge(Object(mt.a)(Object(G.a)(t.prototype),"serialize",this).call(this),{position:this.position})}},{key:"canLinkToPort",value:function(e){return this.in!==e.in}},{key:"deSerialize",value:function(e,n){Object(mt.a)(Object(G.a)(t.prototype),"deSerialize",this).call(this,e,n),this.position=e.position}},{key:"createLinkModel",value:function(){return new pt}}]),t}(q.PortModel),vt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,e,"email"))}return Object(R.a)(t,e),t}(gt),bt=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,"email",e.id))).name=e.name,n.selectedMail=e.selectedMail,n.addPort(new vt("left")),n.addPort(new vt("right")),n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"deSerialize",value:function(e,n){Object(mt.a)(Object(G.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedMail=e.selectedMail}},{key:"serialize",value:function(){return ut.merge(Object(mt.a)(Object(G.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedMail:this.selectedMail})}}]),t}(q.NodeModel),Et=n(29),yt=n.n(Et),Ot=n(36),Nt=n.n(Ot),jt=n(39),kt=n.n(jt),wt=n(34),St=n.n(wt),Pt=n(38),Tt=n.n(Pt),Mt=n(37),Ct=n.n(Mt),xt=n(82),Ft=n.n(xt),_t=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,e))).state={selected:!1},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"getClassName",value:function(){return"port "+Object(mt.a)(Object(G.a)(t.prototype),"getClassName",this).call(this)+(this.state.selected?this.bem("--selected"):"")}},{key:"render",value:function(){var e=this;return c.createElement("div",Object.assign({},this.getProps(),{onMouseEnter:function(){e.setState({selected:!0})},onMouseLeave:function(){e.setState({selected:!1})},"data-name":this.props.name,"data-nodeid":this.props.node.getID()}),this.props.children)}}]),t}(q.PortWidget),Dt=n(124),Ut=n.n(Dt);function It(e){return{type:w,payload:e}}function zt(e){return{type:S,payload:e}}function Bt(e){return{type:P,payload:e}}function Lt(e){return{type:T,payload:e}}function Wt(e){return{type:C,payload:e}}function At(e){return function(t){return t(Wt(!0)),f.a.get(Fe+e).then(function(e){var n;t((n=e.data,{type:M,payload:n})),t(Lt(e.data.name)),t(Bt(e.data.id)),t(Wt(!1))}).catch(function(e){t(Wt(!1)),t(zt({open:!0,variant:"error",text:"Scenario fetching failed."})),console.log(e)})}}function Gt(){return function(e){return e(Wt(!0)),f.a.get("".concat(De)).then(function(t){var n;e((n=t.data.segments,{type:b,payload:n})),e(Wt(!1))}).catch(function(t){console.log(t),e(Wt(!1)),e(zt({open:!0,variant:"error",text:"Segments fetching failed."}))})}}function Rt(){return function(e){return e(Wt(!0)),f.a.get("".concat(Ue)).then(function(t){var n;e((n=t.data.events,{type:E,payload:n})),e(Wt(!1))}).catch(function(t){e(Wt(!1)),console.log(t),e(zt({open:!0,variant:"error",text:"Triggers fetching failed."}))})}}function Vt(){return function(e){return e(Wt(!0)),f.a.get("".concat(Ie)).then(function(t){var n;e((n=t.data.mail_templates,{type:y,payload:n})),e(Wt(!1))}).catch(function(t){e(Wt(!1)),console.log(t),e(zt({open:!0,variant:"error",text:"Mails fetching failed."}))})}}function Ht(){return function(e){return e(Wt(!0)),f.a.get(ze).then(function(t){var n;e((n=t.data.goals,{type:O,payload:n})),e(Wt(!1))}).catch(function(t){e(Wt(!1)),console.log(t),e(zt({open:!0,variant:"error",text:"Goals fetching failed."}))})}}function Kt(){return function(e){return e(Wt(!0)),f.a.get(Be).then(function(t){var n;e((n=t.data.banners,{type:N,payload:n})),e(Wt(!1))}).catch(function(t){e(Wt(!1)),console.log(t),e(zt({open:!0,variant:"error",text:"Banners fetching failed."}))})}}var qt=function(e){function t(){var e,n;Object(L.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(A.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(i)))).state={html:null,loading:!0},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.scenarioID&&this.props.scenarioID!==e.scenarioID&&this.fetchStatistics()}},{key:"fetchStatistics",value:function(){var e=this,t=this.props,n=t.dispatch,a=t.id,i=t.scenarioID;i&&(this.setState({loading:!0}),f.a.get("".concat(Le,"?scenario_id=").concat(i,"&element_uuid=").concat(a)).then(function(t){var n=t.data;e.setState({html:n.html})}).catch(function(e){console.log(e),n(zt({open:!0,variant:"error",text:"Tooltip fetching failed."}))}).then(function(){e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this.props.anchorElement;return this.state.html?d.a.createElement(Ut.a,{open:Boolean(e),anchorEl:e,style:{pointerEvents:"none"},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},this.state.loading&&d.a.createElement("div",{className:"node-tooltip-loader"},d.a.createElement(he.a,{size:30})),d.a.createElement("div",{className:"node-tooltip-wrapper",dangerouslySetInnerHTML:{__html:this.state.html}})):null}}]),t}(d.a.Component);var Jt=Object(u.b)(function(e){return{scenarioID:e.scenario.id}})(qt),Xt=n(67),Yt=n(207),Zt=n(11),$t=n.n(Zt),Qt=n(208),en=n(52),tn=n.n(en),nn=n(193),an=n.n(nn),on=n(31),rn=n.n(on),sn=n(194),ln=n.n(sn),cn=n(60);function dn(e){var t=e.inputRef,n=Object(Yt.a)(e,["inputRef"]);return d.a.createElement("div",Object.assign({ref:t},n))}var mn={Control:function(e){return d.a.createElement(yt.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:dn,inputProps:Object(v.a)({className:e.selectProps.classes.input,inputRef:e.innerRef,children:e.children},e.innerProps)}},e.selectProps.textFieldProps))},Menu:function(e){return d.a.createElement(tn.a,Object.assign({square:!0,className:e.selectProps.classes.paper},e.innerProps),e.children)},MultiValue:function(e){return d.a.createElement(an.a,{tabIndex:-1,label:e.children,className:$t()(e.selectProps.classes.chip,Object(Xt.a)({},e.selectProps.classes.chipFocused,e.isFocused)),onDelete:e.removeProps.onClick,deleteIcon:d.a.createElement(ln.a,e.removeProps)})},NoOptionsMessage:function(e){return d.a.createElement(ce.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.noOptionsMessage},e.innerProps),e.children)},Option:function(e){return d.a.createElement(rn.a,Object.assign({buttonRef:e.innerRef,selected:e.isFocused,component:"div",style:{fontWeight:e.isSelected?500:400}},e.innerProps),e.children)},Placeholder:function(e){return d.a.createElement(ce.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.placeholder},e.innerProps),e.children)},SingleValue:function(e){return d.a.createElement(ce.a,Object.assign({className:e.selectProps.classes.singleValue},e.innerProps),e.children)},ValueContainer:function(e){return d.a.createElement("div",{className:e.selectProps.classes.valueContainer},e.children)}},un=function(e){function t(){var e,n;Object(L.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(A.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(i)))).state={single:null,multi:null},n.handleChange=function(e){return function(t){n.setState(Object(Xt.a)({},e,t))}},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.theme,a={input:function(e){return Object(v.a)({},e,{color:n.palette.text.primary,"& input":{font:"inherit"}})}};return d.a.createElement("div",{className:t.root},d.a.createElement(Qt.a,{classes:t,styles:a,components:mn,menuPosition:"fixed",textFieldProps:{label:this.props.label,InputLabelProps:{shrink:!0}},isMulti:this.props.isMulti,options:this.props.options,value:this.props.value,onChange:this.props.onChange,placeholder:this.props.placeholder}))}}]),t}(d.a.Component);un.defaultProp={isMulti:!1};var pn=Object(ue.withStyles)(function(e){return{root:{flexGrow:1,marginTop:"10px",marginBottom:"10px",fontFamily:"Roboto, Helvetica, Arial, sans-serif"},input:{display:"flex",padding:0},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:"".concat(e.spacing.unit/2,"px ").concat(e.spacing.unit/4,"px")},chipFocused:{backgroundColor:Object(cn.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:"".concat(e.spacing.unit,"px ").concat(2*e.spacing.unit,"px")},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},paper:{position:"absolute",zIndex:1,marginTop:e.spacing.unit,left:0,right:0},divider:{height:2*e.spacing.unit}}},{withTheme:!0})(un),hn=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(It(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(It(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e=n.props.mails.find(function(e){return e.code===n.state.selectedMail});return e?{value:e.code,label:e.name}:{}},n.transformOptionsForSelect=function(){var e=Ft()(n.props.mails,function(e){return e.mail_type.code}),t=[];return Object.keys(e).forEach(function(n){t.push({label:e[n][0].mail_type.name,sorting:e[n][0].mail_type.sorting,options:e[n].map(function(e){return{value:e.code,label:e.name}})})}),t.sort(function(e,t){return e.sorting-t.sorting})},n.getSelectedMailValue=function(){var e=n.props.mails.find(function(e){return e.code===n.props.node.selectedMail});return e?" - ".concat(e.name):""},n.state={nodeFormName:n.props.node.name,selectedMail:n.props.node.selectedMail,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return c.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},c.createElement("div",{className:"node-container"},c.createElement("div",{className:this.bem("__icon")},c.createElement(fe.a,null)),c.createElement("div",{className:this.bem("__ports")},c.createElement("div",{className:this.bem("__left")},c.createElement(_t,{name:"left",node:this.props.node})),c.createElement("div",{className:this.bem("__right")},c.createElement(_t,{name:"right",node:this.props.node})))),c.createElement("div",{className:this.bem("__title")},c.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Mail ".concat(this.getSelectedMailValue()))),c.createElement(Jt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),c.createElement(Nt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},c.createElement(Ct.a,{id:"form-dialog-title"},"Email node"),c.createElement(St.a,null,c.createElement(Tt.a,null,"Sends an email to user."),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:6},c.createElement(yt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:12},c.createElement(pn,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){e.setState({selectedMail:t.value})},placeholder:"Pick one",label:"Selected Mail"})))),c.createElement(kt.a,null,c.createElement(X.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),c.createElement(X.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedMail=e.state.selectedMail,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(c.Component);var gn=Object(u.b)(function(e){return{mails:e.mails.availableMails}})(hn),fn=function(e){function t(){return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,"email"))}return Object(R.a)(t,e),Object(W.a)(t,[{key:"generateReactWidget",value:function(e,t){return c.createElement(gn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"email-node"})}},{key:"getNewInstance",value:function(){return new bt}}]),t}(q.AbstractNodeFactory),vn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,e,"banner"))}return Object(R.a)(t,e),t}(gt),bn=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,"banner",e.id))).name=e.name,n.selectedBanner=e.selectedBanner,n.expiresInTime=e.expiresInTime,n.expiresInUnit=e.expiresInUnit,n.addPort(new vn("left")),n.addPort(new vn("right")),n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"deSerialize",value:function(e,n){Object(mt.a)(Object(G.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedBanner=e.selectedBanner,this.expiresInTime=e.expiresInTime||"1",this.expiresInUnit=e.expiresInUnit||"days"}},{key:"serialize",value:function(){return ut.merge(Object(mt.a)(Object(G.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedBanner:this.selectedBanner,expiresInTime:this.expiresInTime,expiresInUnit:this.expiresInUnit})}}]),t}(q.NodeModel),En=n(45),yn=n.n(En),On=n(44),Nn=n.n(On),jn=n(46),kn=n.n(jn),wn=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(It(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(It(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e=n.props.banners.find(function(e){return e.id===n.state.selectedBanner});return e?{value:e.id,label:e.name}:{}},n.transformOptionsForSelect=function(){return n.props.banners.map(function(e){return{value:e.id,label:e.name}})},n.getSelectedMailValue=function(){var e=n.props.banners.find(function(e){return e.id===n.props.node.selectedBanner});return e?" - ".concat(e.name):""},n.state={nodeFormName:n.props.node.name,selectedBanner:n.props.node.selectedBanner,dialogOpened:!1,anchorElementForTooltip:null,expiresInTime:n.props.node.expiresInTime,expiresInUnit:n.props.node.expiresInUnit},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return c.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},c.createElement("div",{className:"node-container"},c.createElement("div",{className:this.bem("__icon")},c.createElement(be.a,null)),c.createElement("div",{className:this.bem("__ports")},c.createElement("div",{className:this.bem("__left")},c.createElement(_t,{name:"left",node:this.props.node})),c.createElement("div",{className:this.bem("__right")},c.createElement(_t,{name:"right",node:this.props.node})))),c.createElement("div",{className:this.bem("__title")},c.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Banner ".concat(this.getSelectedMailValue()))),c.createElement(Jt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),c.createElement(Nt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},c.createElement(Ct.a,{id:"form-dialog-title"},"Banner node"),c.createElement(St.a,null,c.createElement(Tt.a,null,"Shows a one-time banner to user."),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:6},c.createElement(yt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:12},c.createElement(pn,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){e.setState({selectedBanner:t.value})},placeholder:"Pick one",label:"Selected Banner"}))),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:6},c.createElement(yt.a,{id:"expires-in-time",label:"Expires in",type:"number",helperText:"Banner is not shown after given period",fullWidth:!0,value:this.state.expiresInTime,onChange:function(t){e.setState({expiresInTime:t.target.value})}})),c.createElement(me.a,{item:!0,xs:6},c.createElement(yn.a,{fullWidth:!0},c.createElement(Nn.a,{htmlFor:"time-unit"},"Time unit"),c.createElement(kn.a,{value:this.state.expiresInUnit,onChange:function(t){e.setState({expiresInUnit:t.target.value})},inputProps:{name:"expires-in-unit",id:"expires-in-unit"}},c.createElement(rn.a,{value:"minutes"},"Minutes"),c.createElement(rn.a,{value:"hours"},"Hours"),c.createElement(rn.a,{value:"days"},"Days")))))),c.createElement(kt.a,null,c.createElement(X.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),c.createElement(X.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedBanner=e.state.selectedBanner,e.props.node.expiresInTime=e.state.expiresInTime,e.props.node.expiresInUnit=e.state.expiresInUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(c.Component);var Sn=Object(u.b)(function(e){return{banners:e.banners.availableBanners}})(wn),Pn=function(e){function t(){return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,"banner"))}return Object(R.a)(t,e),Object(W.a)(t,[{key:"generateReactWidget",value:function(e,t){return c.createElement(Sn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"banner-node"})}},{key:"getNewInstance",value:function(){return new bn}}]),t}(q.AbstractNodeFactory),Tn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,e,"segment"))}return Object(R.a)(t,e),t}(ft),Mn=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,"segment",e.id))).name=e.name,n.selectedSegment=e.selectedSegment,n.addPort(new Tn("left")),n.addPort(new Tn("bottom")),n.addPort(new Tn("right")),n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"deSerialize",value:function(e,n){Object(mt.a)(Object(G.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedSegment=e.selectedSegment}},{key:"serialize",value:function(){return ut.merge(Object(mt.a)(Object(G.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedSegment:this.selectedSegment})}}]),t}(q.NodeModel),Cn=n(87),xn=n.n(Cn),Fn=n(198),_n=n.n(Fn),Dn=n(199),Un=n.n(Dn),In=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,selectedSegment:n.props.node.selectedSegment,anchorElementForTooltip:null}),n.props.dispatch(It(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(It(!0))},n.transformOptionsForSelect=function(){var e=Ft()(n.props.segments,function(e){return e.group.name}),t=[];return Object.keys(e).forEach(function(n){t.push({label:n,sorting:e[n][0].group.sorting,options:e[n].map(function(e){return{value:e.code,label:e.name}})})}),t.sort(function(e,t){return e.sorting-t.sorting})},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e=n.props.segments.find(function(e){return e.code===n.state.selectedSegment});return e?{value:e.code,label:e.name}:{}},n.getSelectedSegmentValue=function(){var e=n.props.segments.find(function(e){return e.code===n.props.node.selectedSegment});return e?" - ".concat(e.name):""},n.handleNewSegmentClick=function(){window.addEventListener("savedSegment",n.handleSavedNewSegment),window.addEventListener("canceledNewSegment",n.handleCancelNewSegment),n.setState({creatingNewSegment:!0}),setTimeout(function(){V.init()})},n.handleSavedNewSegment=function(e){n.props.dispatch(Gt()),n.setState({selectedSegment:e.detail.code,creatingNewSegment:!1}),n.props.node.name=n.state.nodeFormName,n.props.node.selectedSegment=n.state.selectedSegment,n.props.diagramEngine.repaintCanvas(),n.closeDialog(),window.removeEventListener("savedSegment",n.handleSavedNewSegment)},n.handleCancelNewSegment=function(e){n.setState({creatingNewSegment:!1}),window.removeEventListener("canceledNewSegment",n.handleSavedNewSegment)},n.state={nodeFormName:n.props.node.name,selectedSegment:n.props.node.selectedSegment,dialogOpened:!1,anchorElementForTooltip:null,creatingNewSegment:!1},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return c.createElement("div",{className:this.getClassName(),onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},c.createElement("div",{className:this.bem("__title")},c.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Segment ".concat(this.getSelectedSegmentValue()))),c.createElement("div",{className:"node-container"},c.createElement("div",{className:this.bem("__icon")},c.createElement(ke.a,null)),c.createElement("div",{className:this.bem("__ports")},c.createElement("div",{className:this.bem("__left")},c.createElement(_t,{name:"left",node:this.props.node})),c.createElement("div",{className:this.bem("__right")},c.createElement(_t,{name:"right",node:this.props.node},c.createElement(xn.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),c.createElement("div",{className:this.bem("__bottom")},c.createElement(_t,{name:"bottom",node:this.props.node},c.createElement(_n.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),c.createElement(Jt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),c.createElement(Nt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullScreen:this.state.creatingNewSegment,disableEscapeKeyDown:this.state.creatingNewSegment},!this.state.creatingNewSegment&&c.createElement(c.Fragment,null,c.createElement(Ct.a,{id:"form-dialog-title"},"Segment node"),c.createElement(St.a,null,c.createElement(Tt.a,null,"Segments evaluate user's presence in a group of users defined by system-provided conditions. Execution flow can be directed based on presence/absence of user within the selected segment. You can either pick one of the existing segments or create a new one."),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:6},c.createElement(yt.a,{margin:"normal",id:"segment-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),c.createElement(me.a,{container:!0,spacing:32,alignItems:"flex-end"},c.createElement(me.a,{item:!0,xs:8},c.createElement(pn,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){console.log(t.value),e.setState({selectedSegment:t.value})},placeholder:"Pick one",label:"Selected Segment"})),window.RempSegmenter&&c.createElement(me.a,{item:!0,xs:4},c.createElement(X.a,{variant:"contained",color:"primary",size:"small",style:{position:"relative",bottom:"10px"},onClick:this.handleNewSegmentClick},c.createElement(Un.a,{style:{marginRight:"5px"}},"add_circle"),"New segment"))))),this.state.creatingNewSegment&&c.createElement(St.a,null,c.createElement("div",{id:"segmenter",style:{position:"fixed",zIndex:"99999999"}})),!this.state.creatingNewSegment&&c.createElement(kt.a,null,c.createElement(X.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),c.createElement(X.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedSegment=e.state.selectedSegment,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(c.Component);var zn=Object(u.b)(function(e){var t=e.segments,n=e.dispatch;return{segments:t.avalaibleSegments,dispatch:n}})(In),Bn=function(e){function t(){return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,"segment"))}return Object(R.a)(t,e),Object(W.a)(t,[{key:"generateReactWidget",value:function(e,t){return c.createElement(zn,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"segment-node"})}},{key:"getNewInstance",value:function(){return new Mn}}]),t}(q.AbstractNodeFactory),Ln=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,e,"trigger"))}return Object(R.a)(t,e),t}(gt),Wn=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,"trigger",e.id))).name=e.name,n.selectedTrigger=e.selectedTrigger,n.addPort(new Ln("right")),n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"deSerialize",value:function(e,n){Object(mt.a)(Object(G.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedTrigger=e.selectedTrigger}},{key:"serialize",value:function(){return ut.merge(Object(mt.a)(Object(G.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedTrigger:this.selectedTrigger})}}]),t}(q.NodeModel),An=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(It(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(It(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getTriggersInSelectableFormat=function(){return n.props.triggers.map(function(e){return{value:e.code,label:e.name}})},n.getSelectedTriggerValue=function(){var e=n.getTriggersInSelectableFormat().find(function(e){return e.value===n.props.node.selectedTrigger});return e?" - ".concat(e.label):""},n.state={nodeFormName:n.props.node.name,selectedTrigger:n.props.node.selectedTrigger,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return c.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},c.createElement("div",{className:"node-container"},c.createElement("div",{className:this.bem("__icon")},c.createElement(ye.a,null)),c.createElement("div",{className:this.bem("__ports")},c.createElement("div",{className:this.bem("__right")},c.createElement(_t,{name:"right",node:this.props.node})))),c.createElement("div",{className:this.bem("__title")},c.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Event ".concat(this.getSelectedTriggerValue()))),c.createElement(Nt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},c.createElement(Ct.a,{id:"form-dialog-title"},"Trigger node"),c.createElement(St.a,null,c.createElement(Tt.a,null,'Events are emitted on any change related to user. We recommend to combine "before" events with "Wait" operations to achieve execution at any desired time.'),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:6},c.createElement(yt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:12},c.createElement(pn,{options:this.getTriggersInSelectableFormat(),value:this.getTriggersInSelectableFormat().find(function(t){return t.value===e.state.selectedTrigger}),onChange:function(t){e.setState({selectedTrigger:t.value})},placeholder:"Pick one",label:"Selected Trigger"})))),c.createElement(kt.a,null,c.createElement(X.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),c.createElement(X.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedTrigger=e.state.selectedTrigger,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(c.Component);var Gn=Object(u.b)(function(e){return{triggers:e.triggers.avalaibleTriggers}})(An),Rn=function(e){function t(){return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,"trigger"))}return Object(R.a)(t,e),Object(W.a)(t,[{key:"generateReactWidget",value:function(e,t){return c.createElement(Gn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"trigger-node"})}},{key:"getNewInstance",value:function(){return new Wn}}]),t}(q.AbstractNodeFactory),Vn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,e,"wait"))}return Object(R.a)(t,e),t}(gt),Hn=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,"wait",e.id))).name=e.name,n.waitingTime=e.waitingTime||10,n.waitingUnit=e.waitingUnit||"minutes",n.addPort(new Vn("left")),n.addPort(new Vn("right")),n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"deSerialize",value:function(e,n){Object(mt.a)(Object(G.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.waitingTime=e.waitingTime,this.waitingUnit=e.waitingUnit}},{key:"serialize",value:function(){return ut.merge(Object(mt.a)(Object(G.a)(t.prototype),"serialize",this).call(this),{name:this.name,waitingTime:this.waitingTime,waitingUnit:this.waitingUnit})}}]),t}(q.NodeModel),Kn=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormWaitingTime:n.props.node.waitingTime,nodeFormName:n.props.node.name,timeUnit:n.props.node.waitingUnit,anchorElementForTooltip:null}),n.props.dispatch(It(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(It(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.state={nodeFormWaitingTime:n.props.node.waitingTime,nodeFormName:n.props.node.name,timeUnit:n.props.node.waitingUnit,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return c.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},c.createElement("div",{className:"node-container"},c.createElement("div",{className:this.bem("__icon")},c.createElement(Ne.a,null)),c.createElement("div",{className:this.bem("__ports")},c.createElement("div",{className:this.bem("__left")},c.createElement(_t,{name:"left",node:this.props.node})),c.createElement("div",{className:this.bem("__right")},c.createElement(_t,{name:"right",node:this.props.node})))),c.createElement("div",{className:this.bem("__title")},c.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Wait - ".concat(this.props.node.waitingTime," ").concat(this.props.node.waitingUnit))),c.createElement(Jt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),c.createElement(Nt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},c.createElement(Ct.a,{id:"form-dialog-title"},"Wait node"),c.createElement(St.a,null,c.createElement(Tt.a,null,"Postpones the execution of next node in flow by selected amount of time."),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:6},c.createElement(yt.a,{margin:"normal",id:"waiting-time",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:6},c.createElement(yt.a,{id:"waiting-time",label:"Waiting time",type:"number",fullWidth:!0,value:this.state.nodeFormWaitingTime,onChange:function(t){e.setState({nodeFormWaitingTime:t.target.value})}})),c.createElement(me.a,{item:!0,xs:6},c.createElement(yn.a,{fullWidth:!0},c.createElement(Nn.a,{htmlFor:"time-unit"},"Time unit"),c.createElement(kn.a,{value:this.state.timeUnit,onChange:function(t){e.setState({timeUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},c.createElement(rn.a,{value:"minutes"},"Minutes"),c.createElement(rn.a,{value:"hours"},"Hours"),c.createElement(rn.a,{value:"days"},"Days")))))),c.createElement(kt.a,null,c.createElement(X.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),c.createElement(X.a,{color:"primary",onClick:function(){e.props.node.waitingTime=e.state.nodeFormWaitingTime,e.props.node.name=e.state.nodeFormName,e.props.node.waitingUnit=e.state.timeUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(c.Component);var qn=Object(u.b)(function(e){return{segments:e.segments.avalaibleSegments}})(Kn),Jn=function(e){function t(){return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,"wait"))}return Object(R.a)(t,e),Object(W.a)(t,[{key:"generateReactWidget",value:function(e,t){return c.createElement(qn,{diagramEngine:e,node:t,classBaseName:"round-node",className:"wait-node"})}},{key:"getNewInstance",value:function(){return new Hn}}]),t}(q.AbstractNodeFactory),Xn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,e,"goal"))}return Object(R.a)(t,e),t}(ft),Yn=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,"goal",e.id))).name=e.name,n.selectedGoals=e.selectedGoals,n.timeoutTime=e.timeoutTime,n.timeoutUnit=e.timeoutUnit,n.recheckPeriodTime=e.recheckPeriodTime,n.recheckPeriodUnit=e.recheckPeriodUnit,n.addPort(new Xn("left")),n.addPort(new Xn("bottom")),n.addPort(new Xn("right")),n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"deSerialize",value:function(e,n){Object(mt.a)(Object(G.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedGoals=e.selectedGoals,this.timeoutTime=e.timeoutTime||"",this.timeoutUnit=e.timeoutUnit||"days",this.recheckPeriodTime=e.recheckPeriodTime||"1",this.recheckPeriodUnit=e.recheckPeriodUnit||"hours"}},{key:"serialize",value:function(){return ut.merge(Object(mt.a)(Object(G.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedGoals:this.selectedGoals,timeoutTime:this.timeoutTime,timeoutUnit:this.timeoutUnit,recheckPeriodTime:this.recheckPeriodTime,recheckPeriodUnit:this.recheckPeriodUnit})}}]),t}(q.NodeModel),Zn=n(200),$n=n.n(Zn),Qn=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,selectedGoals:n.props.node.selectedGoals,timeoutTime:n.props.node.timeoutTime,timeoutUnit:n.props.node.timeoutUnit,recheckPeriodTime:n.props.node.recheckPeriodTime,recheckPeriodUnit:n.props.node.recheckPeriodUnit,anchorElementForTooltip:null}),n.props.dispatch(It(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(It(!0))},n.transformOptionsForSelect=function(){return n.props.goals.map(function(e){return{value:e.code,label:e.name}})},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e={};n.props.goals.forEach(function(t){e[t.code]=t});var t=[];return void 0!==n.state.selectedGoals&&n.state.selectedGoals.forEach(function(n){t.push({value:n,label:e[n].name})}),t},n.state={nodeFormName:n.props.node.name,selectedGoals:n.props.node.selectedGoals,timeoutTime:n.props.node.timeoutTime,timeoutUnit:n.props.node.timeoutUnit,recheckPeriodTime:n.props.node.recheckPeriodTime,recheckPeriodUnit:n.props.node.recheckPeriodUnit,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return c.createElement("div",{className:this.getClassName(),onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},c.createElement("div",{className:this.bem("__title")},c.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Goal")),c.createElement("div",{className:"node-container"},c.createElement("div",{className:this.bem("__icon")},c.createElement(Se.a,null)),c.createElement("div",{className:this.bem("__ports")},c.createElement("div",{className:this.bem("__left")},c.createElement(_t,{name:"left",node:this.props.node})),c.createElement("div",{className:this.bem("__right")},c.createElement(_t,{name:"right",node:this.props.node},c.createElement(xn.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),c.createElement("div",{className:this.bem("__bottom")},c.createElement(_t,{name:"bottom",node:this.props.node},c.createElement($n.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),c.createElement(Jt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),c.createElement(Nt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},c.createElement(Ct.a,{id:"form-dialog-title"},"Goal node"),c.createElement(St.a,null,c.createElement(Tt.a,null,"Goal node evaluates whether user has completed selected onboarding goals. Timeout value can be optionally specified, defining a point in time when evalution of completed goals is stopped. Execution flow can be directed two ways from the node - a positive direction, when all goals are completed, or a negative one, when timeout threshold is reached."),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:6},c.createElement(yt.a,{margin:"normal",id:"goal-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:12},c.createElement(pn,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){e.setState({selectedGoals:t.map(function(e){return e.value})})},isMulti:!0,placeholder:"Pick goals",label:"Selected Goal(s)"}))),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:6},c.createElement(yt.a,{id:"recheck-period-time",label:"Recheck period time",type:"number",helperText:"How often goals completition should be checked",fullWidth:!0,value:this.state.recheckPeriodTime,onChange:function(t){e.setState({recheckPeriodTime:t.target.value})}})),c.createElement(me.a,{item:!0,xs:6},c.createElement(yn.a,{fullWidth:!0},c.createElement(Nn.a,{htmlFor:"time-unit"},"Time unit"),c.createElement(kn.a,{value:this.state.recheckPeriodUnit,onChange:function(t){e.setState({recheckPeriodUnit:t.target.value})},inputProps:{name:"recheck-period-unit",id:"recheck-period-unit"}},c.createElement(rn.a,{value:"minutes"},"Minutes"),c.createElement(rn.a,{value:"hours"},"Hours"),c.createElement(rn.a,{value:"days"},"Days"))))),c.createElement(me.a,{container:!0,spacing:32},c.createElement(me.a,{item:!0,xs:6},c.createElement(yt.a,{id:"timeout-time",label:"Timeout time",type:"number",placeholder:"No timeout",helperText:"Optionally select a timeout",fullWidth:!0,value:this.state.timeoutTime,onChange:function(t){e.setState({timeoutTime:t.target.value})}})),c.createElement(me.a,{item:!0,xs:6},c.createElement(yn.a,{fullWidth:!0},c.createElement(Nn.a,{htmlFor:"time-unit"},"Time unit"),c.createElement(kn.a,{value:this.state.timeoutUnit,onChange:function(t){e.setState({timeoutUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},c.createElement(rn.a,{value:"minutes"},"Minutes"),c.createElement(rn.a,{value:"hours"},"Hours"),c.createElement(rn.a,{value:"days"},"Days")))))),c.createElement(kt.a,null,c.createElement(X.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),c.createElement(X.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedGoals=e.state.selectedGoals,e.props.node.timeoutTime=e.state.timeoutTime,e.props.node.timeoutUnit=e.state.timeoutUnit,e.props.node.recheckPeriodTime=e.state.recheckPeriodTime,e.props.node.recheckPeriodUnit=e.state.recheckPeriodUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(c.Component);var ea=Object(u.b)(function(e){var t=e.goals,n=e.dispatch;return{goals:t.availableGoals,dispatch:n}})(Qn),ta=function(e){function t(){return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).call(this,"goal"))}return Object(R.a)(t,e),Object(W.a)(t,[{key:"generateReactWidget",value:function(e,t){return c.createElement(ea,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"goal-node"})}},{key:"getNewInstance",value:function(){return new Yn}}]),t}(q.AbstractNodeFactory),na=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(A.a)(this,Object(G.a)(t).call(this,e))).saveChanges=function(){var e=n.props.dispatch;if(n.props.app.isCorruptedPayload())e(zt({open:!0,variant:"error",text:"Cannot modify corrupted scenario."}));else{var t=new Xe(n.props.app.getDiagramEngine().getDiagramModel()),a=Object(v.a)({name:n.props.scenario.name},t.exportPayload()),i=n.props.scenario.id;i&&(a.id=i),e(Wt(!0)),f.a.post("".concat(_e),a).then(function(t){e(Bt(t.data.id)),e(Wt(!1)),e(zt({open:!0,variant:"success",text:"Scenario saving succeeded."}))}).catch(function(t){e(Wt(!1)),e(zt({open:!0,variant:"error",text:"Scenario saving failed."})),console.log(t)})}},n.startEditingName=function(){n.setState({editedName:n.props.scenario.name,editingName:!0})},n.cancelEditingName=function(){n.setState({editedName:"",editingName:!1})},n.submitEditingName=function(){0!==n.state.editedName.length?(n.props.dispatch(Lt(n.state.editedName)),n.setState({editedName:"",editingName:!1})):n.cancelEditingName()},n.handleCloseAndSaveDuringChangingName=function(e){27===e.keyCode?n.cancelEditingName():13===e.keyCode&&n.submitEditingName()},n.handleNameTyping=function(e){n.setState({editedName:e.target.value})},n.closeNotification=function(){n.props.dispatch(zt({open:!1}))},n.state={editingName:!1,editedName:""},n}return Object(R.a)(t,e),Object(W.a)(t,[{key:"componentDidUpdate",value:function(e){!0===this.props.app.isCorruptedPayload()&&!1===e.app.isCorruptedPayload()&&this.props.dispatch(zt({open:!0,variant:"error",text:"Unable to load corrupted scenario."}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.classes,d=t.canvas,m={className:"srd-demo-canvas",diagramEngine:this.props.app.getDiagramEngine(),maxNumberPointsPerLink:0,allowLooseLinks:!1,allowCanvasTranslation:d.pannable,allowCanvasZoom:d.zoomable};return c.createElement("div",{className:"body"},c.createElement("div",{className:n.root},c.createElement(te.a,null),c.createElement(Q.a,{position:"fixed",className:n.appBar},c.createElement(ae.a,null,c.createElement(me.a,{container:!0},c.createElement(me.a,{item:!0,xs:4},c.createElement(ce.a,{variant:"h6",color:"inherit",noWrap:!0},this.state.editingName?c.createElement("input",{autoFocus:!0,type:"text",value:this.state.editedName,onChange:this.handleNameTyping,onKeyDown:this.handleCloseAndSaveDuringChangingName,onBlur:this.cancelEditingName,className:"changing-name-input"}):c.createElement("span",{onClick:this.startEditingName,className:"scenario-name"},this.props.scenario.name))),c.createElement(me.a,{item:!0,xs:8},c.createElement(me.a,{container:!0,direction:"row",justify:"flex-end"},!!this.props.scenario.loading&&c.createElement(he.a,{className:"circular-loading",size:19,color:"inherit"}),c.createElement(X.a,{size:"small",variant:"contained",color:"secondary",onClick:function(){return e.saveChanges()}},this.props.scenario.id?"Update":"Save")))))),c.createElement(Z.a,{className:n.drawer,variant:"permanent",classes:{paper:n.drawerPaper}},c.createElement("div",{className:n.toolbar}),c.createElement(oe.a,{component:"nav",subheader:c.createElement(se.a,{component:"div"},"Triggers")},c.createElement(Ke,{model:{type:"trigger"},name:"Event",icon:c.createElement(ye.a,null)})),c.createElement(oe.a,{component:"nav",subheader:c.createElement(se.a,{component:"div"},"Actions")},c.createElement(Ke,{model:{type:"email"},name:"Send email",icon:c.createElement(fe.a,null)}),xe&&c.createElement(Ke,{model:{type:"banner"},name:"Show banner",icon:c.createElement(be.a,null)})),c.createElement(oe.a,{component:"nav",subheader:c.createElement(se.a,{component:"div"},"Operations")},c.createElement(Ke,{model:{type:"segment"},name:"Segment",icon:c.createElement(ke.a,null)}),c.createElement(Ke,{model:{type:"wait"},name:"Wait",icon:c.createElement(Ne.a,null)}),c.createElement(Ke,{model:{type:"goal"},name:"Goal",icon:c.createElement(Se.a,null)}))),c.createElement(ct,{variant:this.props.canvas.notification.variant,text:this.props.canvas.notification.text,open:this.props.canvas.notification.open,handleClose:this.closeNotification}),c.createElement("main",{className:n.content},c.createElement("div",{className:"diagram-layer",onDrop:function(t){var n=t.dataTransfer.getData("storm-diagram-node");if(n){var c=JSON.parse(n),d=null;"email"===c.type?d=new a.NodeModel({}):"banner"===c.type?d=new i.NodeModel({expiresInUnit:"days",expiresInTime:1}):"segment"===c.type?d=new o.NodeModel({}):"trigger"===c.type?d=new r.NodeModel({}):"wait"===c.type?d=new s.NodeModel({}):"goal"===c.type&&(d=new l.NodeModel({recheckPeriodUnit:"hours",recheckPeriodTime:1}));var m=e.props.app.getDiagramEngine().getRelativeMousePoint(t);d.x=m.x,d.y=m.y,e.props.app.getDiagramEngine().getDiagramModel().addNode(d),e.forceUpdate()}},onDragOver:function(e){e.preventDefault()}},c.createElement(q.DiagramWidget,m)))))}}]),t}(c.Component);var aa=K()(Object(ue.withStyles)(function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},content:{flexGrow:1,padding:0},toolbar:e.mixins.toolbar}},{name:"BodyWidget"}),Object(u.b)(function(e){return{canvas:e.canvas,scenario:e.scenario}},null))(na),ia=(n(476),n(205)),oa=n.n(ia);function ra(e){return e%1440===0?{unit:"days",time:e/1440}:e%60===0?{unit:"hours",time:e/60}:{unit:"minutes",time:e}}var sa=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(L.a)(this,e),this.activeModel=t,this.payload=n}return Object(W.a)(e,[{key:"renderPayload",value:function(e){var t=this;this.payload=e,oa()(e.triggers,function(n){var a=e.visual[n.id];return t.renderElements(n,a)})}},{key:"renderElements",value:function(e,t){var n=this,c=[],d=null;if("event"===e.type)e.selectedTrigger=e.event.code,d=new r.NodeModel(e),c=e.elements.flatMap(function(e){var t=n.payload.elements[e],a=n.payload.visual[t.id],i=n.renderElements(t,a),o=d.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(o),i});else if("email"===e.type)e.selectedMail=e.email.code,d=new a.NodeModel(e),c=e.email.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),o=d.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(o),i});else if("banner"===e.type){if(!xe)throw Error("BANNER_ENABLED configuration is false, but loaded scenario contains banner element.");var m=ra(e.banner.expiresInMinutes);e.expiresInUnit=m.unit,e.expiresInTime=m.time,e.selectedBanner=e.banner.id,d=new i.NodeModel(e),c=e.banner.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),o=d.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(o),i})}else if("segment"===e.type)e.selectedSegment=e.segment.code,d=new o.NodeModel(e),c=e.segment.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a);if(e.direction)if("positive"===e.direction){var o=d.getPort("right").link(i[0].getPort("left"));n.activeModel.addLink(o)}else if("negative"===e.direction){var r=d.getPort("bottom").link(i[0].getPort("left"));n.activeModel.addLink(r)}return i});else if("wait"===e.type){var u=ra(e.wait.minutes);e.waitingUnit=u.unit,e.waitingTime=u.time,d=new s.NodeModel(e),c=e.wait.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),o=d.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(o),i})}else if("goal"===e.type){if(e.goal.hasOwnProperty("timeoutMinutes")){var p=ra(e.goal.timeoutMinutes);e.timeoutUnit=p.unit,e.timeoutTime=p.time}var h=ra(e.goal.recheckPeriodMinutes);e.recheckPeriodUnit=h.unit,e.recheckPeriodTime=h.time,e.selectedGoals=e.goal.codes,d=new l.NodeModel(e),c=e.goal.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a);if(e.direction)if("positive"===e.direction){var o=d.getPort("right").link(i[0].getPort("left"));n.activeModel.addLink(o)}else if("negative"===e.direction){var r=d.getPort("bottom").link(i[0].getPort("left"));n.activeModel.addLink(r)}return i})}return this.activeModel.addNode(d),d.setPosition(t.x,t.y),[d].concat(Object(qe.a)(c))}}]),e}(),la=function(){function e(t){Object(L.a)(this,e),this.diagramEngine=new q.DiagramEngine,this.diagramEngine.installDefaultFactories(),this.activeModel=new q.DiagramModel,this.renderService=new sa(this.activeModel),this.payload=t,this.corruptedPayload=!1,t?this.renderPayload():this.registerCustomModels()}return Object(W.a)(e,[{key:"renderPayload",value:function(){this.registerCustomModels();try{this.renderService.renderPayload(this.payload)}catch(e){console.log(e.message),this.corruptedPayload=!0,this.activeModel=new q.DiagramModel}this.diagramEngine.setDiagramModel(this.activeModel),this.diagramEngine.repaintCanvas()}},{key:"registerCustomModels",value:function(){this.diagramEngine.registerLinkFactory(new ht),this.diagramEngine.registerPortFactory(new dt("email",function(e){return new a.PortModel})),this.diagramEngine.registerNodeFactory(new a.NodeFactory),this.diagramEngine.registerPortFactory(new dt("segment",function(e){return new o.PortModel})),this.diagramEngine.registerNodeFactory(new o.NodeFactory),this.diagramEngine.registerPortFactory(new dt("trigger",function(e){return new r.PortModel})),this.diagramEngine.registerNodeFactory(new r.NodeFactory),this.diagramEngine.registerPortFactory(new dt("wait",function(e){return new s.PortModel})),this.diagramEngine.registerNodeFactory(new s.NodeFactory),this.diagramEngine.registerPortFactory(new dt("goal",function(e){return new l.PortModel})),this.diagramEngine.registerNodeFactory(new l.NodeFactory),this.diagramEngine.registerPortFactory(new dt("banner",function(e){return new i.PortModel})),this.diagramEngine.registerNodeFactory(new i.NodeFactory)}},{key:"getActiveDiagram",value:function(){return this.activeModel}},{key:"getDiagramEngine",value:function(){return this.diagramEngine}},{key:"isCorruptedPayload",value:function(){return this.corruptedPayload}}]),e}(),ca=function(e){function t(){return Object(L.a)(this,t),Object(A.a)(this,Object(G.a)(t).apply(this,arguments))}return Object(R.a)(t,e),Object(W.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e(Gt()),e(Ht()),e(Rt()),e(Vt()),xe&&e(Kt()),e(Ce?At(Ce):Lt("Unnamed scenario")),V.load()}},{key:"render",value:function(){var e=new la(this.props.scenarioPayload);return d.a.createElement(aa,{app:e})}}]),t}(c.Component);var da=Object(u.b)(function(e){return{scenarioPayload:e.scenario.payload}})(ca);window.__MUI_USE_NEXT_TYPOGRAPHY_VARIANTS__=!0,f.a.defaults.headers.common.Authorization=Te;var ma=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||p.d,ua=Object(p.e)(B,{},ma(Object(p.a)(h.a)));Object(m.render)(d.a.createElement(u.a,{store:ua},d.a.createElement(da,null)),document.getElementById("root"))}},[[209,2,1]]]);
//# sourceMappingURL=main.7ddbb3d7.chunk.js.map