(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{204:function(e,t,n){e.exports=n(475)},469:function(e,t,n){},475:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"NodeModel",function(){return it}),n.d(a,"NodeFactory",function(){return Qt}),n.d(a,"PortModel",function(){return at});var i={};n.r(i),n.d(i,"NodeModel",function(){return tn}),n.d(i,"NodeFactory",function(){return mn}),n.d(i,"PortModel",function(){return en});var r={};n.r(r),n.d(r,"NodeModel",function(){return pn}),n.d(r,"NodeFactory",function(){return fn}),n.d(r,"PortModel",function(){return un});var o={};n.r(o),n.d(o,"NodeModel",function(){return bn}),n.d(o,"NodeFactory",function(){return Mn}),n.d(o,"PortModel",function(){return vn});var s=n(0),l=n.n(s),c=n(25),d=n(26),m=n(44),u=n(179),p=n(29),g=n.n(p),h=n(22),f="segments_changed",v="triggers_changed",b="mails_changed",E="canvas_zoomable",y="canvas_pannable",O="canvas_zoomable_pannable",N="canvas_notification",j="set_scenario_id",w="set_scenario_name",S="set_scenario_payload",k="set_scenario_loading",M={avalaibleSegments:[]},C={avalaibleTriggers:[]},T={pannable:!0,zoomable:!0,notification:{open:!1,variant:"success",text:""}},_={id:null,name:"",loading:0,payload:null},P={availableMails:[]},F=Object(m.c)({segments:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return Object(h.a)({},e,{avalaibleSegments:t.payload});default:return e}},triggers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case v:return Object(h.a)({},e,{avalaibleTriggers:t.payload});default:return e}},canvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return Object(h.a)({},e,{pannable:t.payload});case E:return Object(h.a)({},e,{zoomable:t.payload});case O:return Object(h.a)({},e,{zoomable:t.payload,pannable:t.payload});case N:return Object(h.a)({},e,{notification:Object(h.a)({},e.notification,t.payload)});default:return e}},scenario:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return Object(h.a)({},e,{id:t.payload});case w:return Object(h.a)({},e,{name:t.payload});case k:var n=e.loading;return t.payload?++n:--n,Object(h.a)({},e,{loading:n});case S:return Object(h.a)({},e,{payload:t.payload});default:return e}},mails:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:return Object(h.a)({},e,{availableMails:t.payload});default:return e}}}),D=n(5),x=n(9),z=n(7),L=n(3),I=n(8),U=function(){function e(){Object(D.a)(this,e)}return Object(x.a)(e,null,[{key:"load",value:function(){var e=document.createElement("script");e.type="text/javascript",e.src="/segmenter/vue.min.js";var t=document.createElement("script");t.type="text/javascript",t.src="/segmenter/RempSegmenter.umd.min.js";var n=document.createElement("link");n.rel="stylesheet",n.href="/segmenter/RempSegmenter.css",document.head.appendChild(e),document.head.appendChild(t),document.head.appendChild(n)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#segmenter";new window.Vue({render:function(e){return e(window.RempSegmenter)}}).$mount(e)}}]),e}(),W=n(180),A=n.n(W),R=n(14),B=n(27),V=n.n(B),H=n(199),K=n.n(H),J=n(197),q=n.n(J),G=n(196),X=n.n(G),Y=n(198),Z=n.n(Y),$=n(65),Q=n.n($),ee=n(89),te=n.n(ee),ne=n(35),ae=n.n(ne),ie=n(21),re=n.n(ie),oe=n(56),se=n(82),le=n.n(se),ce=n(83),de=n.n(ce),me=n(85),ue=n.n(me),pe=n(86),ge=n.n(pe),he=n(84),fe=n.n(he),ve=window.Scenario.config,be=ve.AUTH_TOKEN,Ee=ve.API_HOST,ye=ve.SCENARIO_ID,Oe="".concat(Ee,"/scenarios/info?id="),Ne="".concat(Ee,"/scenarios/create"),je="".concat(Ee,"/user-segments/list"),we="".concat(Ee,"/events/list"),Se="".concat(Ee,"/mail-template/list"),ke="".concat(Ee,"/scenarios/element"),Me=n(117),Ce=n.n(Me),Te=n(181),_e=n.n(Te),Pe=n(182),Fe=n.n(Pe),De=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,e))).state={},n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this;return s.createElement(Ce.a,{key:this.props.name,draggable:!0,onDragStart:function(t){t.dataTransfer.setData("storm-diagram-node",JSON.stringify(e.props.model))},className:"tray-item"},s.createElement(_e.a,null,this.props.icon),s.createElement(Fe.a,{primary:this.props.name}))}}]),t}(s.Component),xe=n(66),ze=function(){function e(t){Object(D.a)(this,e),this.formatDescendant=function(e,t){var n={uuid:e.id};return"segment"===t.type&&(n.segment={direction:"right"===e.portName?"positive":"negative"}),n},this.model=t}return Object(x.a)(e,[{key:"exportPayload",value:function(){var e=this,t={},n=this.model.serializeDiagram();return t.triggers={},t.elements={},t.visual={},n.nodes.filter(function(e){return"trigger"===e.type}).map(function(n){return t.triggers[n.id]=e.formatNode(n)}),Object.entries(this.model.getNodes()).forEach(function(e){t.visual[e[0]]={x:e[1].x,y:e[1].y}}),Object.entries(this.model.getNodes()).forEach(function(n){"trigger"!==n[1].type&&(t.elements[n[0]]=e.formatNode(n[1].serialize()))}),t}},{key:"getAllChildrenNodes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";return e.ports.find(function(e){return e.name===n}).links.map(function(a){var i=null;return i=t.model.links[a].targetPort.parent.id!==e.id?t.model.links[a].targetPort.parent:t.model.links[a].sourcePort.parent,Object(h.a)({},i.serialize(),{portName:n})})}},{key:"formatNode",value:function(e){var t=this;if(console.log(e.type),"email"===e.type)return{id:e.id,name:e.name?e.name:"",type:"email",email:{code:e.selectedMail,descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}};if("segment"===e.type){var n=this.getAllChildrenNodes(e,"right").map(function(n){return t.formatDescendant(n,e)}),a=this.getAllChildrenNodes(e,"bottom").map(function(n){return t.formatDescendant(n,e)});return{id:e.id,name:e.name?e.name:"",type:"segment",segment:{code:e.selectedSegment?e.selectedSegment:"all_users",descendants:[].concat(Object(xe.a)(n),Object(xe.a)(a))}}}if("trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"event",event:{code:e.selectedTrigger?e.selectedTrigger:"user_created"},elements:this.getAllChildrenNodes(e).map(function(e){return e.id})};if("wait"===e.type){var i=0;switch(e.waitingUnit){case"minutes":i=e.waitingTime;break;case"hours":i=60*e.waitingTime;break;case"days":i=60*e.waitingTime*24;break;default:i=e.waitingTime}return{id:e.id,name:e.name?e.name:"",type:"wait",wait:{minutes:i,descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}}}}}]),e}(),Le=n(187),Ie=n.n(Le),Ue=n(118),We=n.n(Ue),Ae=n(183),Re=n.n(Ae),Be=n(185),Ve=n.n(Be),He=n(186),Ke=n.n(He),Je=n(184),qe=n.n(Je),Ge={success:Re.a,warning:qe.a,error:Ve.a,info:Ke.a},Xe=function(e){function t(){return Object(D.a)(this,t),Object(z.a)(this,Object(L.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=Ge[this.props.variant];return l.a.createElement(Ie.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:this.props.open,autoHideDuration:3e3,onClose:this.props.handleClose},l.a.createElement(We.a,{className:"toast-"+this.props.variant,message:l.a.createElement("span",{id:"client-snackbar",className:"toast__message"},l.a.createElement(e,{className:"toast__icon toast__icon-variant"}),this.props.text)}))}}]),t}(l.a.Component),Ye=function(e){function t(e,n){var a;return Object(D.a)(this,t),(a=Object(z.a)(this,Object(L.a)(t).call(this,e))).cb=n,a}return Object(I.a)(t,e),Object(x.a)(t,[{key:"getNewInstance",value:function(e){return this.cb(e)}}]),t}(R.AbstractPortFactory),Ze=n(24),$e=n(30),Qe=function(e){function t(){var e;return Object(D.a)(this,t),(e=Object(z.a)(this,Object(L.a)(t).call(this,"custom"))).width=3,e.curvyness=50,e.color="rgba(0,0,0,0.3)",e}return Object(I.a)(t,e),t}(R.DefaultLinkModel),et=function(e){function t(){var e;return Object(D.a)(this,t),(e=Object(z.a)(this,Object(L.a)(t).call(this))).type="custom",e}return Object(I.a)(t,e),Object(x.a)(t,[{key:"getNewInstance",value:function(e){return new Qe}},{key:"generateLinkSegment",value:function(e,t,n,a){return s.createElement("path",{className:n?t.bem("--path-selected"):"",strokeWidth:e.width,stroke:e.color,d:a})}}]),t}(R.DefaultLinkFactory),tt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",a=arguments.length>1?arguments[1]:void 0;return Object(D.a)(this,t),(e=Object(z.a)(this,Object(L.a)(t).call(this,n,a))).position=n,e.in="left"===e.position,e}return Object(I.a)(t,e),Object(x.a)(t,[{key:"link",value:function(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}},{key:"canLinkToPort",value:function(e){return this.in!==e.in}},{key:"serialize",value:function(){return $e.merge(Object(Ze.a)(Object(L.a)(t.prototype),"serialize",this).call(this),{position:this.position})}},{key:"deSerialize",value:function(e,n){Object(Ze.a)(Object(L.a)(t.prototype),"deSerialize",this).call(this,e,n),this.position=e.position}},{key:"createLinkModel",value:function(){return new Qe}}]),t}(R.PortModel),nt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",a=arguments.length>1?arguments[1]:void 0;return Object(D.a)(this,t),(e=Object(z.a)(this,Object(L.a)(t).call(this,n,a))).position=n,e.in="left"===e.position,e}return Object(I.a)(t,e),Object(x.a)(t,[{key:"link",value:function(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}},{key:"serialize",value:function(){return $e.merge(Object(Ze.a)(Object(L.a)(t.prototype),"serialize",this).call(this),{position:this.position})}},{key:"canLinkToPort",value:function(e){return this.in!==e.in}},{key:"deSerialize",value:function(e,n){Object(Ze.a)(Object(L.a)(t.prototype),"deSerialize",this).call(this,e,n),this.position=e.position}},{key:"createLinkModel",value:function(){return new Qe}}]),t}(R.PortModel),at=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(D.a)(this,t),Object(z.a)(this,Object(L.a)(t).call(this,e,"email"))}return Object(I.a)(t,e),t}(tt),it=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,"email",e.id))).name=e.name,n.selectedMail=e.selectedMail,n.addPort(new at("left")),n.addPort(new at("right")),n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"deSerialize",value:function(e,n){Object(Ze.a)(Object(L.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedMail=e.selectedMail}},{key:"serialize",value:function(){return $e.merge(Object(Ze.a)(Object(L.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedMail:this.selectedMail})}}]),t}(R.NodeModel),rt=n(34),ot=n.n(rt),st=n(40),lt=n.n(st),ct=n(43),dt=n.n(ct),mt=n(38),ut=n.n(mt),pt=n(42),gt=n.n(pt),ht=n(41),ft=n.n(ht),vt=n(81),bt=n.n(vt),Et=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,e))).state={selected:!1},n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"getClassName",value:function(){return"port "+Object(Ze.a)(Object(L.a)(t.prototype),"getClassName",this).call(this)+(this.state.selected?this.bem("--selected"):"")}},{key:"render",value:function(){var e=this;return s.createElement("div",Object.assign({},this.getProps(),{onMouseEnter:function(){e.setState({selected:!0})},onMouseLeave:function(){e.setState({selected:!1})},"data-name":this.props.name,"data-nodeid":this.props.node.getID()}),this.props.children)}}]),t}(R.PortWidget),yt=n(119),Ot=n.n(yt);function Nt(e){return{type:O,payload:e}}function jt(e){return{type:N,payload:e}}function wt(e){return{type:j,payload:e}}function St(e){return{type:w,payload:e}}function kt(e){return{type:k,payload:e}}function Mt(e){return function(t){return t(kt(!0)),g.a.get(Oe+e).then(function(e){var n;t((n=e.data,{type:S,payload:n})),t(St(e.data.name)),t(wt(e.data.id)),t(kt(!1))}).catch(function(e){t(kt(!1)),t(jt({open:!0,variant:"error",text:"Scenario fetching failed."})),console.log(e)})}}function Ct(){return function(e){return e(kt(!0)),g.a.get("".concat(je)).then(function(t){var n;e((n=t.data.segments,{type:f,payload:n})),e(kt(!1))}).catch(function(t){console.log(t),e(kt(!1)),e(jt({open:!0,variant:"error",text:"Segments fetching failed."}))})}}function Tt(){return function(e){return e(kt(!0)),g.a.get("".concat(we)).then(function(t){var n;e((n=t.data.events,{type:v,payload:n})),e(kt(!1))}).catch(function(t){e(kt(!1)),console.log(t),e(jt({open:!0,variant:"error",text:"Triggers fetching failed."}))})}}function _t(){return function(e){return e(kt(!0)),g.a.get("".concat(Se)).then(function(t){var n;e((n=t.data.mail_templates,{type:b,payload:n})),e(kt(!1))}).catch(function(t){e(kt(!1)),console.log(t),e(jt({open:!0,variant:"error",text:"Mails fetching failed."}))})}}var Pt=function(e){function t(){var e,n;Object(D.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(z.a)(this,(e=Object(L.a)(t)).call.apply(e,[this].concat(i)))).state={html:null,loading:!0},n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.scenarioID&&this.props.scenarioID!==e.scenarioID&&this.fetchStatistics()}},{key:"fetchStatistics",value:function(){var e=this,t=this.props,n=t.dispatch,a=t.id,i=t.scenarioID;i&&(this.setState({loading:!0}),g.a.get("".concat(ke,"?scenario_id=").concat(i,"&element_uuid=").concat(a)).then(function(t){var n=t.data;e.setState({html:n.html})}).catch(function(e){console.log(e),n(jt({open:!0,variant:"error",text:"Tooltip fetching failed."}))}).then(function(){e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this.props.anchorElement;return this.state.html?l.a.createElement(Ot.a,{open:Boolean(e),anchorEl:e,style:{pointerEvents:"none"},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},this.state.loading&&l.a.createElement("div",{className:"node-tooltip-loader"},l.a.createElement(le.a,{size:30})),l.a.createElement("div",{className:"node-tooltip-wrapper",dangerouslySetInnerHTML:{__html:this.state.html}})):null}}]),t}(l.a.Component);var Ft=Object(d.b)(function(e){return{scenarioID:e.scenario.id}})(Pt),Dt=n(64),xt=n(203),zt=n(10),Lt=n.n(zt),It=n(202),Ut=n(47),Wt=n.n(Ut),At=n(188),Rt=n.n(At),Bt=n(57),Vt=n.n(Bt),Ht=n(189),Kt=n.n(Ht),Jt=n(55);function qt(e){var t=e.inputRef,n=Object(xt.a)(e,["inputRef"]);return l.a.createElement("div",Object.assign({ref:t},n))}var Gt={Control:function(e){return l.a.createElement(ot.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:qt,inputProps:Object(h.a)({className:e.selectProps.classes.input,inputRef:e.innerRef,children:e.children},e.innerProps)}},e.selectProps.textFieldProps))},Menu:function(e){return l.a.createElement(Wt.a,Object.assign({square:!0,className:e.selectProps.classes.paper},e.innerProps),e.children)},MultiValue:function(e){return l.a.createElement(Rt.a,{tabIndex:-1,label:e.children,className:Lt()(e.selectProps.classes.chip,Object(Dt.a)({},e.selectProps.classes.chipFocused,e.isFocused)),onDelete:e.removeProps.onClick,deleteIcon:l.a.createElement(Kt.a,e.removeProps)})},NoOptionsMessage:function(e){return l.a.createElement(ae.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.noOptionsMessage},e.innerProps),e.children)},Option:function(e){return l.a.createElement(Vt.a,Object.assign({buttonRef:e.innerRef,selected:e.isFocused,component:"div",style:{fontWeight:e.isSelected?500:400}},e.innerProps),e.children)},Placeholder:function(e){return l.a.createElement(ae.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.placeholder},e.innerProps),e.children)},SingleValue:function(e){return l.a.createElement(ae.a,Object.assign({className:e.selectProps.classes.singleValue},e.innerProps),e.children)},ValueContainer:function(e){return l.a.createElement("div",{className:e.selectProps.classes.valueContainer},e.children)}},Xt=function(e){function t(){var e,n;Object(D.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(z.a)(this,(e=Object(L.a)(t)).call.apply(e,[this].concat(i)))).state={single:null,multi:null},n.handleChange=function(e){return function(t){n.setState(Object(Dt.a)({},e,t))}},n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.theme,a={input:function(e){return Object(h.a)({},e,{color:n.palette.text.primary,"& input":{font:"inherit"}})}};return l.a.createElement("div",{className:t.root},l.a.createElement(It.a,{classes:t,styles:a,components:Gt,menuPosition:"fixed",textFieldProps:{label:this.props.label,InputLabelProps:{shrink:!0}},options:this.props.options,value:this.props.value,onChange:this.props.onChange,placeholder:this.props.placeholder}))}}]),t}(l.a.Component),Yt=Object(oe.withStyles)(function(e){return{root:{flexGrow:1,marginTop:"10px",marginBottom:"10px",fontFamily:"Roboto, Helvetica, Arial, sans-serif"},input:{display:"flex",padding:0},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:"".concat(e.spacing.unit/2,"px ").concat(e.spacing.unit/4,"px")},chipFocused:{backgroundColor:Object(Jt.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:"".concat(e.spacing.unit,"px ").concat(2*e.spacing.unit,"px")},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},paper:{position:"absolute",zIndex:1,marginTop:e.spacing.unit,left:0,right:0},divider:{height:2*e.spacing.unit}}},{withTheme:!0})(Xt),Zt=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(Nt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Nt(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e=n.props.mails.find(function(e){return e.code===n.state.selectedMail});return e?{value:e.code,label:e.name}:{}},n.transformOptionsForSelect=function(){var e=bt()(n.props.mails,function(e){return e.mail_type.code}),t=[];return Object.keys(e).forEach(function(n){t.push({label:e[n][0].mail_type.name,sorting:e[n][0].mail_type.sorting,options:e[n].map(function(e){return{value:e.code,label:e.name}})})}),t.sort(function(e,t){return e.sorting-t.sorting})},n.getSelectedMailValue=function(){var e=n.props.mails.find(function(e){return e.code===n.props.node.selectedMail});return e?" - ".concat(e.name):""},n.state={nodeFormName:n.props.node.name,selectedMail:n.props.node.selectedMail,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return s.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},s.createElement("div",{className:"node-container"},s.createElement("div",{className:this.bem("__icon")},s.createElement(de.a,null)),s.createElement("div",{className:this.bem("__ports")},s.createElement("div",{className:this.bem("__left")},s.createElement(Et,{name:"left",node:this.props.node})),s.createElement("div",{className:this.bem("__right")},s.createElement(Et,{name:"right",node:this.props.node})))),s.createElement("div",{className:this.bem("__title")},s.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Mail ".concat(this.getSelectedMailValue()))),s.createElement(Ft,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),s.createElement(lt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},s.createElement(ft.a,{id:"form-dialog-title"},"Email node"),s.createElement(ut.a,null,s.createElement(gt.a,null,"Sends an email to user."),s.createElement(re.a,{container:!0,spacing:32},s.createElement(re.a,{item:!0,xs:6},s.createElement(ot.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),s.createElement(re.a,{container:!0,spacing:32},s.createElement(re.a,{item:!0,xs:12},s.createElement(Yt,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){e.setState({selectedMail:t.value})},placeholder:"Pick one",label:"Selected Mail"})))),s.createElement(dt.a,null,s.createElement(V.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),s.createElement(V.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedMail=e.state.selectedMail,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(s.Component);var $t=Object(d.b)(function(e){return{mails:e.mails.availableMails}})(Zt),Qt=function(e){function t(){return Object(D.a)(this,t),Object(z.a)(this,Object(L.a)(t).call(this,"email"))}return Object(I.a)(t,e),Object(x.a)(t,[{key:"generateReactWidget",value:function(e,t){return s.createElement($t,{diagramEngine:e,node:t,classBaseName:"square-node",className:"email-node"})}},{key:"getNewInstance",value:function(){return new it}}]),t}(R.AbstractNodeFactory),en=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(D.a)(this,t),Object(z.a)(this,Object(L.a)(t).call(this,e,"segment"))}return Object(I.a)(t,e),t}(nt),tn=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,"segment",e.id))).name=e.name,n.selectedSegment=e.selectedSegment,n.addPort(new en("left")),n.addPort(new en("bottom")),n.addPort(new en("right")),n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"deSerialize",value:function(e,n){Object(Ze.a)(Object(L.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedSegment=e.selectedSegment}},{key:"serialize",value:function(){return $e.merge(Object(Ze.a)(Object(L.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedSegment:this.selectedSegment})}}]),t}(R.NodeModel),nn=n(193),an=n.n(nn),rn=n(194),on=n.n(rn),sn=n(195),ln=n.n(sn),cn=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,selectedSegment:n.props.node.selectedSegment,anchorElementForTooltip:null}),n.props.dispatch(Nt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Nt(!0))},n.transformOptionsForSelect=function(){var e=bt()(n.props.segments,function(e){return e.group.name}),t=[];return Object.keys(e).forEach(function(n){t.push({label:n,sorting:e[n][0].group.sorting,options:e[n].map(function(e){return{value:e.code,label:e.name}})})}),t.sort(function(e,t){return e.sorting-t.sorting})},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e=n.props.segments.find(function(e){return e.code===n.state.selectedSegment});return e?{value:e.code,label:e.name}:{}},n.getSelectedSegmentValue=function(){var e=n.props.segments.find(function(e){return e.code===n.props.node.selectedSegment});return e?" - ".concat(e.name):""},n.handleNewSegmentClick=function(){window.addEventListener("savedSegment",n.handleSavedNewSegment),window.addEventListener("canceledNewSegment",n.handleCancelNewSegment),n.setState({creatingNewSegment:!0}),setTimeout(function(){U.init()})},n.handleSavedNewSegment=function(e){n.props.dispatch(Ct()),n.setState({selectedSegment:e.detail.code,creatingNewSegment:!1}),n.props.node.name=n.state.nodeFormName,n.props.node.selectedSegment=n.state.selectedSegment,n.props.diagramEngine.repaintCanvas(),n.closeDialog(),window.removeEventListener("savedSegment",n.handleSavedNewSegment)},n.handleCancelNewSegment=function(e){n.setState({creatingNewSegment:!1}),window.removeEventListener("canceledNewSegment",n.handleSavedNewSegment)},n.state={nodeFormName:n.props.node.name,selectedSegment:n.props.node.selectedSegment,dialogOpened:!1,anchorElementForTooltip:null,creatingNewSegment:!1},n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return s.createElement("div",{className:this.getClassName(),onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},s.createElement("div",{className:this.bem("__title")},s.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Segment ".concat(this.getSelectedSegmentValue()))),s.createElement("div",{className:"node-container"},s.createElement("div",{className:this.bem("__icon")},s.createElement(fe.a,null)),s.createElement("div",{className:this.bem("__ports")},s.createElement("div",{className:this.bem("__left")},s.createElement(Et,{name:"left",node:this.props.node})),s.createElement("div",{className:this.bem("__right")},s.createElement(Et,{name:"right",node:this.props.node},s.createElement(an.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),s.createElement("div",{className:this.bem("__bottom")},s.createElement(Et,{name:"bottom",node:this.props.node},s.createElement(on.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),s.createElement(Ft,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),s.createElement(lt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullScreen:this.state.creatingNewSegment,disableEscapeKeyDown:this.state.creatingNewSegment},!this.state.creatingNewSegment&&s.createElement(s.Fragment,null,s.createElement(ft.a,{id:"form-dialog-title"},"Segment node"),s.createElement(ut.a,null,s.createElement(gt.a,null,"Segments evaluate user's presence in a group of users defined by system-provided conditions. Execution flow can be directed based on presence/absence of user within the selected segment. You can either pick one of the existing segments or create a new one."),s.createElement(re.a,{container:!0,spacing:32},s.createElement(re.a,{item:!0,xs:6},s.createElement(ot.a,{margin:"normal",id:"segment-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),s.createElement(re.a,{container:!0,spacing:32,alignItems:"flex-end"},s.createElement(re.a,{item:!0,xs:8},s.createElement(Yt,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){console.log(t.value),e.setState({selectedSegment:t.value})},placeholder:"Pick one",label:"Selected Segment"})),window.RempSegmenter&&s.createElement(re.a,{item:!0,xs:4},s.createElement(V.a,{variant:"contained",color:"primary",size:"small",style:{position:"relative",bottom:"10px"},onClick:this.handleNewSegmentClick},s.createElement(ln.a,{style:{marginRight:"5px"}},"add_circle"),"New segment"))))),this.state.creatingNewSegment&&s.createElement(ut.a,null,s.createElement("div",{id:"segmenter",style:{position:"fixed",zIndex:"99999999"}})),!this.state.creatingNewSegment&&s.createElement(dt.a,null,s.createElement(V.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),s.createElement(V.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedSegment=e.state.selectedSegment,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(s.Component);var dn=Object(d.b)(function(e){var t=e.segments,n=e.dispatch;return{segments:t.avalaibleSegments,dispatch:n}})(cn),mn=function(e){function t(){return Object(D.a)(this,t),Object(z.a)(this,Object(L.a)(t).call(this,"segment"))}return Object(I.a)(t,e),Object(x.a)(t,[{key:"generateReactWidget",value:function(e,t){return s.createElement(dn,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"segment-node"})}},{key:"getNewInstance",value:function(){return new tn}}]),t}(R.AbstractNodeFactory),un=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(D.a)(this,t),Object(z.a)(this,Object(L.a)(t).call(this,e,"trigger"))}return Object(I.a)(t,e),t}(tt),pn=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,"trigger",e.id))).name=e.name,n.selectedTrigger=e.selectedTrigger,n.addPort(new un("right")),n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"deSerialize",value:function(e,n){Object(Ze.a)(Object(L.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedTrigger=e.selectedTrigger}},{key:"serialize",value:function(){return $e.merge(Object(Ze.a)(Object(L.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedTrigger:this.selectedTrigger})}}]),t}(R.NodeModel),gn=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(Nt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Nt(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getTriggersInSelectableFormat=function(){return n.props.triggers.map(function(e){return{value:e.code,label:e.name}})},n.getSelectedTriggerValue=function(){var e=n.getTriggersInSelectableFormat().find(function(e){return e.value===n.props.node.selectedTrigger});return e?" - ".concat(e.label):""},n.state={nodeFormName:n.props.node.name,selectedTrigger:n.props.node.selectedTrigger,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return s.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},s.createElement("div",{className:"node-container"},s.createElement("div",{className:this.bem("__icon")},s.createElement(ue.a,null)),s.createElement("div",{className:this.bem("__ports")},s.createElement("div",{className:this.bem("__right")},s.createElement(Et,{name:"right",node:this.props.node})))),s.createElement("div",{className:this.bem("__title")},s.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Event ".concat(this.getSelectedTriggerValue()))),s.createElement(Ft,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),s.createElement(lt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},s.createElement(ft.a,{id:"form-dialog-title"},"Trigger node"),s.createElement(ut.a,null,s.createElement(gt.a,null,'Events are emitted on any change related to user. We recommend to combine "before" events with "Wait" operations to achieve execution at any desired time.'),s.createElement(re.a,{container:!0,spacing:32},s.createElement(re.a,{item:!0,xs:6},s.createElement(ot.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),s.createElement(re.a,{container:!0,spacing:32},s.createElement(re.a,{item:!0,xs:12},s.createElement(Yt,{options:this.getTriggersInSelectableFormat(),value:this.getTriggersInSelectableFormat().find(function(t){return t.value===e.state.selectedTrigger}),onChange:function(t){e.setState({selectedTrigger:t.value})},placeholder:"Pick one",label:"Selected Trigger"})))),s.createElement(dt.a,null,s.createElement(V.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),s.createElement(V.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedTrigger=e.state.selectedTrigger,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(s.Component);var hn=Object(d.b)(function(e){return{triggers:e.triggers.avalaibleTriggers}})(gn),fn=function(e){function t(){return Object(D.a)(this,t),Object(z.a)(this,Object(L.a)(t).call(this,"trigger"))}return Object(I.a)(t,e),Object(x.a)(t,[{key:"generateReactWidget",value:function(e,t){return s.createElement(hn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"trigger-node"})}},{key:"getNewInstance",value:function(){return new pn}}]),t}(R.AbstractNodeFactory),vn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(D.a)(this,t),Object(z.a)(this,Object(L.a)(t).call(this,e,"wait"))}return Object(I.a)(t,e),t}(tt),bn=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,"wait",e.id))).name=e.name,n.waitingTime=e.waitingTime||10,n.waitingUnit=e.waitingUnit||"minutes",n.addPort(new vn("left")),n.addPort(new vn("right")),n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"deSerialize",value:function(e,n){Object(Ze.a)(Object(L.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.waitingTime=e.waitingTime,this.waitingUnit=e.waitingUnit}},{key:"serialize",value:function(){return $e.merge(Object(Ze.a)(Object(L.a)(t.prototype),"serialize",this).call(this),{name:this.name,waitingTime:this.waitingTime,waitingUnit:this.waitingUnit})}}]),t}(R.NodeModel),En=n(120),yn=n.n(En),On=n(122),Nn=n.n(On),jn=n(121),wn=n.n(jn),Sn=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormWaitingTime:n.props.node.waitingTime,nodeFormName:n.props.node.name,timeUnit:n.props.node.waitingUnit,anchorElementForTooltip:null}),n.props.dispatch(Nt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Nt(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.state={nodeFormWaitingTime:n.props.node.waitingTime,nodeFormName:n.props.node.name,timeUnit:n.props.node.waitingUnit,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return s.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},s.createElement("div",{className:"node-container"},s.createElement("div",{className:this.bem("__icon")},s.createElement(ge.a,null)),s.createElement("div",{className:this.bem("__ports")},s.createElement("div",{className:this.bem("__left")},s.createElement(Et,{name:"left",node:this.props.node})),s.createElement("div",{className:this.bem("__right")},s.createElement(Et,{name:"right",node:this.props.node})))),s.createElement("div",{className:this.bem("__title")},s.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Wait - ".concat(this.props.node.waitingTime," ").concat(this.props.node.waitingUnit))),s.createElement(Ft,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),s.createElement(lt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},s.createElement(ft.a,{id:"form-dialog-title"},"Wait node"),s.createElement(ut.a,null,s.createElement(gt.a,null,"Postpones the execution of next node in flow by selected amount of time."),s.createElement(re.a,{container:!0,spacing:32},s.createElement(re.a,{item:!0,xs:6},s.createElement(ot.a,{margin:"normal",id:"waiting-time",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),s.createElement(re.a,{container:!0,spacing:32},s.createElement(re.a,{item:!0,xs:6},s.createElement(ot.a,{id:"waiting-time",label:"Waiting time",type:"number",fullWidth:!0,value:this.state.nodeFormWaitingTime,onChange:function(t){e.setState({nodeFormWaitingTime:t.target.value})}})),s.createElement(re.a,{item:!0,xs:6},s.createElement(wn.a,{fullWidth:!0},s.createElement(yn.a,{htmlFor:"time-unit"},"Time unit"),s.createElement(Nn.a,{value:this.state.timeUnit,onChange:function(t){e.setState({timeUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},s.createElement(Vt.a,{value:"minutes"},"Minutes"),s.createElement(Vt.a,{value:"hours"},"Hours"),s.createElement(Vt.a,{value:"days"},"Days")))))),s.createElement(dt.a,null,s.createElement(V.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),s.createElement(V.a,{color:"primary",onClick:function(){e.props.node.waitingTime=e.state.nodeFormWaitingTime,e.props.node.name=e.state.nodeFormName,e.props.node.waitingUnit=e.state.timeUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(s.Component);var kn=Object(d.b)(function(e){return{segments:e.segments.avalaibleSegments}})(Sn),Mn=function(e){function t(){return Object(D.a)(this,t),Object(z.a)(this,Object(L.a)(t).call(this,"wait"))}return Object(I.a)(t,e),Object(x.a)(t,[{key:"generateReactWidget",value:function(e,t){return s.createElement(kn,{diagramEngine:e,node:t,classBaseName:"round-node",className:"wait-node"})}},{key:"getNewInstance",value:function(){return new bn}}]),t}(R.AbstractNodeFactory),Cn=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(z.a)(this,Object(L.a)(t).call(this,e))).saveChanges=function(){var e=n.props.dispatch,t=new ze(n.props.app.getDiagramEngine().getDiagramModel()),a=Object(h.a)({name:n.props.scenario.name},t.exportPayload()),i=n.props.scenario.id;i&&(a.id=i),e(kt(!0)),g.a.post("".concat(Ne),a).then(function(t){e(wt(t.data.id)),e(kt(!1)),e(jt({open:!0,variant:"success",text:"Scenario saving succeeded."}))}).catch(function(t){e(kt(!1)),e(jt({open:!0,variant:"error",text:"Scenario saving failed."})),console.log(t)})},n.startEditingName=function(){n.setState({editedName:n.props.scenario.name,editingName:!0})},n.cancelEditingName=function(){n.setState({editedName:"",editingName:!1})},n.submitEditingName=function(){0!==n.state.editedName.length?(n.props.dispatch(St(n.state.editedName)),n.setState({editedName:"",editingName:!1})):n.cancelEditingName()},n.handleCloseAndSaveDuringChangingName=function(e){27===e.keyCode?n.cancelEditingName():13===e.keyCode&&n.submitEditingName()},n.handleNameTyping=function(e){n.setState({editedName:e.target.value})},n.closeNotification=function(){n.props.dispatch(jt({open:!1}))},n.state={editingName:!1,editedName:""},n}return Object(I.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.classes,l=t.canvas,c={className:"srd-demo-canvas",diagramEngine:this.props.app.getDiagramEngine(),maxNumberPointsPerLink:0,allowLooseLinks:!1,allowCanvasTranslation:l.pannable,allowCanvasZoom:l.zoomable};return s.createElement("div",{className:"body"},s.createElement("div",{className:n.root},s.createElement(X.a,null),s.createElement(q.a,{position:"fixed",className:n.appBar},s.createElement(Z.a,null,s.createElement(re.a,{container:!0},s.createElement(re.a,{item:!0,xs:4},s.createElement(ae.a,{variant:"h6",color:"inherit",noWrap:!0},this.state.editingName?s.createElement("input",{autoFocus:!0,type:"text",value:this.state.editedName,onChange:this.handleNameTyping,onKeyDown:this.handleCloseAndSaveDuringChangingName,onBlur:this.cancelEditingName,className:"changing-name-input"}):s.createElement("span",{onClick:this.startEditingName,className:"scenario-name"},this.props.scenario.name))),s.createElement(re.a,{item:!0,xs:8},s.createElement(re.a,{container:!0,direction:"row",justify:"flex-end"},!!this.props.scenario.loading&&s.createElement(le.a,{className:"circular-loading",size:19,color:"inherit"}),s.createElement(V.a,{size:"small",variant:"contained",color:"secondary",onClick:function(){return e.saveChanges()}},this.props.scenario.id?"Update":"Save")))))),s.createElement(K.a,{className:n.drawer,variant:"permanent",classes:{paper:n.drawerPaper}},s.createElement("div",{className:n.toolbar}),s.createElement(Q.a,{component:"nav",subheader:s.createElement(te.a,{component:"div"},"Triggers")},s.createElement(De,{model:{type:"trigger"},name:"Event",icon:s.createElement(ue.a,null)})),s.createElement(Q.a,{component:"nav",subheader:s.createElement(te.a,{component:"div"},"Actions")},s.createElement(De,{model:{type:"email"},name:"Send email",icon:s.createElement(de.a,null)})),s.createElement(Q.a,{component:"nav",subheader:s.createElement(te.a,{component:"div"},"Operations")},s.createElement(De,{model:{type:"segment"},name:"Segment",icon:s.createElement(fe.a,null)}),s.createElement(De,{model:{type:"wait"},name:"Wait",icon:s.createElement(ge.a,null)}))),s.createElement(Xe,{variant:this.props.canvas.notification.variant,text:this.props.canvas.notification.text,open:this.props.canvas.notification.open,handleClose:this.closeNotification}),s.createElement("main",{className:n.content},s.createElement("div",{className:"diagram-layer",onDrop:function(t){var n=t.dataTransfer.getData("storm-diagram-node");if(n){var s=JSON.parse(n),l=null;"email"===s.type?l=new a.NodeModel({}):"segment"===s.type?l=new i.NodeModel({}):"trigger"===s.type?l=new r.NodeModel({}):"wait"===s.type&&(l=new o.NodeModel({}));var c=e.props.app.getDiagramEngine().getRelativeMousePoint(t);l.x=c.x,l.y=c.y,e.props.app.getDiagramEngine().getDiagramModel().addNode(l),e.forceUpdate()}},onDragOver:function(e){e.preventDefault()}},s.createElement(R.DiagramWidget,c)))))}}]),t}(s.Component);var Tn=A()(Object(oe.withStyles)(function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},content:{flexGrow:1,padding:0},toolbar:e.mixins.toolbar}},{name:"BodyWidget"}),Object(d.b)(function(e){return{canvas:e.canvas,scenario:e.scenario}},null))(Cn),_n=(n(469),n(200)),Pn=n.n(_n),Fn=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(D.a)(this,e),this.activeModel=t,this.payload=n}return Object(x.a)(e,[{key:"renderPayload",value:function(e){var t=this;this.payload=e,Pn()(e.triggers,function(n){var a=e.visual[n.id];return t.renderElements(n,a)})}},{key:"renderElements",value:function(e,t){var n=this,s=[],l=null;return"event"===e.type?(e.selectedTrigger=e.event.code,l=new r.NodeModel(e),s=e.elements.flatMap(function(e){var t=n.payload.elements[e],a=n.payload.visual[t.id],i=n.renderElements(t,a),r=l.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(r),i})):"email"===e.type?(e.selectedMail=e.email.code,l=new a.NodeModel(e),s=e.email.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),r=l.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(r),i})):"segment"===e.type?(e.selectedSegment=e.segment.code,l=new i.NodeModel(e),s=e.segment.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a);if(e.segment&&"positive"===e.segment.direction){var r=l.getPort("right").link(i[0].getPort("left"));n.activeModel.addLink(r)}else if(e.segment&&"negative"===e.segment.direction){var o=l.getPort("bottom").link(i[0].getPort("left"));n.activeModel.addLink(o)}return i})):"wait"===e.type&&(e.wait.minutes%1440===0?(e.waitingUnit="days",e.waitingTime=e.wait.minutes/1440):e.wait.minutes%60===0?(e.waitingUnit="hours",e.waitingTime=e.wait.minutes/60):(e.waitingUnit="minutes",e.waitingTime=e.wait.minutes),l=new o.NodeModel(e),s=e.wait.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),r=l.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(r),i})),this.activeModel.addNode(l),l.setPosition(t.x,t.y),[l].concat(Object(xe.a)(s))}}]),e}(),Dn=function(){function e(t){Object(D.a)(this,e),this.diagramEngine=new R.DiagramEngine,this.diagramEngine.installDefaultFactories(),this.activeModel=new R.DiagramModel,this.renderService=new Fn(this.activeModel),this.payload=t,t?this.renderPaylod():this.registerCustomModels()}return Object(x.a)(e,[{key:"renderPaylod",value:function(){this.registerCustomModels(),this.renderService.renderPayload(this.payload),this.diagramEngine.setDiagramModel(this.activeModel),this.diagramEngine.repaintCanvas()}},{key:"registerCustomModels",value:function(){this.diagramEngine.registerLinkFactory(new et),this.diagramEngine.registerPortFactory(new Ye("email",function(e){return new a.PortModel})),this.diagramEngine.registerNodeFactory(new a.NodeFactory),this.diagramEngine.registerPortFactory(new Ye("segment",function(e){return new i.PortModel})),this.diagramEngine.registerNodeFactory(new i.NodeFactory),this.diagramEngine.registerPortFactory(new Ye("trigger",function(e){return new r.PortModel})),this.diagramEngine.registerNodeFactory(new r.NodeFactory),this.diagramEngine.registerPortFactory(new Ye("wait",function(e){return new o.PortModel})),this.diagramEngine.registerNodeFactory(new o.NodeFactory)}},{key:"getActiveDiagram",value:function(){return this.activeModel}},{key:"getDiagramEngine",value:function(){return this.diagramEngine}}]),e}(),xn=function(e){function t(){return Object(D.a)(this,t),Object(z.a)(this,Object(L.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(x.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e(Ct()),e(Tt()),e(_t()),e(ye?Mt(ye):St("Unnamed scenario")),U.load()}},{key:"render",value:function(){var e=new Dn(this.props.scenarioPayload);return l.a.createElement(Tn,{app:e})}}]),t}(s.Component);var zn=Object(d.b)(function(e){return{scenarioPayload:e.scenario.payload}})(xn);window.__MUI_USE_NEXT_TYPOGRAPHY_VARIANTS__=!0,g.a.defaults.headers.common.Authorization=be;var Ln=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||m.d,In=Object(m.e)(F,{},Ln(Object(m.a)(u.a)));Object(c.render)(l.a.createElement(d.a,{store:In},l.a.createElement(zn,null)),document.getElementById("root"))}},[[204,2,1]]]);
//# sourceMappingURL=main.41d95d01.chunk.js.map